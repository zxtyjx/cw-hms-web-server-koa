webpackJsonp([421],{1794:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){function n(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}var r=a(38),o=a.n(r),c=a(256),i=a.n(c),s=a(491),p=a.n(s),d=a(3047),u=a(60),l=(a.n(u),a(489)),m=a(555),_=a(3048),h=new _.a,f=new l.a,g={namespace:"M01378025A120LT00201",state:d.a,subscriptions:{historyListenEvent:function(e){var a=e.history,n=e.dispatch;return a.listen(function(e){var a=p()("/main/:tabIndex/0137/80/25/A/120/L/T/002/01/:paramobject/:encryptstr").exec(e.pathname);if(a){var r=t.__COMPARISON__&&t.__COMPARISON__(a);n({type:"updateTopForm",routeParams:r})}})}},effects:{initData:o.a.mark(function t(e,a){var n,r,c,s,p,d,u,l,m,_,g,y,x,v,b=e.ifedit,D=e.item,w=e.usecache,O=a.select,k=a.put,A=a.call;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!w){t.next=4;break}return t.next=3,k(Object.assign({type:"updateTopForm"},w));case 3:return t.abrupt("return",t.sent);case 4:return t.next=6,A(h.getMenberList);case 6:return n=t.sent,t.next=9,A(f.queryDictionary,["PARA_TRNCODE"]);case 9:return r=t.sent,t.next=12,O(function(t){return t.M01378025A120LT00201});case 12:if(c=t.sent,s=i()(c.elements),p=i()(c.formdata),d=i()(c.formdata_mid),u=i()(c.elements_mid),l=i()(c.elements_bot),m=i()(c.element_top_type),_=c.oldeditdata,g=[],y=[],x=!1,s.charge_top_lev.componentOptions.options=n.data.map(function(t,e){return{key:e,value:String(t.memberrank_id),text:t.memberrank_nm}}),u.charge_mid_code.componentOptions.options=r.PARA_TRNCODE.filter(function(t){return"940"==t["data-datasource"].trn_typ}),!b){t.next=47;break}return t.next=26,A(h.getDetailData,{chargepolicyId:D.chargepolicy_id});case 26:v=t.sent,null==v.resultData.additionParamDtos&&(v.resultData.additionParamDtos=[]),v.resultData.additionParamDtos.map(function(t,e){null==t.cpParamDtos&&(v.resultData.additionParamDtos[e].cpParamDtos=[])}),_=v.resultData,x=!0,p.charge_top_code=v.resultData.chargepolicyCd,p.charge_top_name=v.resultData.chargepolicyNm,p.charge_top_type=[v.resultData.chargepolicyTyp],p.charge_top_trnAmt=v.resultData.trnAmt,p.charge_top_seq=v.resultData.seq,p.charge_top_note=v.resultData.note,p.charge_top_trncdId=[String(v.resultData.trncdId)],p.charge_top_lev=v.resultData.rankDtos.map(function(t){return String(t.memberrankId)}),m.charge_top_trncdId.componentOptions.options="502"===v.resultData.chargepolicyTyp?r.PARA_TRNCODE.filter(function(t){return"C"===t["data-datasource"].normal}):r.PARA_TRNCODE.filter(function(t){return"D"===t["data-datasource"].normal&&"280"===t["data-datasource"].trn_typ}),g=v.resultData.additionParamDtos.filter(function(t){return"R01"===t.cpadditionTyp}),y=v.resultData.additionParamDtos.filter(function(t){return"R02"===t.cpadditionTyp}),d.charge_mid_code=g[0].trncdId,g.length&&g[0].cpParamDtos.length&&(u.charge_mid_type.componentOptions.disabled=!0,u.charge_mid_code.componentOptions.disabled=!0),y.length&&y[0].cpParamDtos.length&&(l.charge_bot_type.componentOptions.disabled=!0),t.next=49;break;case 47:p={charge_top_code:"",charge_top_name:"",charge_top_lev:[],charge_top_type:[],charge_top_trncdId:[],charge_top_trnAmt:"",charge_top_seq:"",charge_top_note:""},d.charge_mid_code="";case 49:return t.next=51,k({type:"updateTopForm",elements:s,formdata:p,elements_mid:u,elements_bot:l,stored_value_data:g,awarding_data:y,element_top_type:m,isnew:x,oldeditdata:_,formdata_mid:d,tradecodedata:r.PARA_TRNCODE});case 51:case"end":return t.stop()}},t,this)}),callBack:o.a.mark(function t(e,a){var n,r,c,s,p,d,u,l,m,_,h,f,g,y,x=e.params,v=a.select,b=a.put;a.call;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v(function(t){return t.M01378025A120LT00201});case 2:return n=t.sent,r=i()(n.stored_value_data),c=i()(n.awarding_data),s=i()(n.elements_mid),p=i()(n.elements_bot),d=x.newparams,u=x.id,l=x.type,m=n.formdata_mid.charge_mid_type[0],_=n.formdata_bot.charge_bot_type[0],h=n.formdata_mid.charge_mid_code,f={calcTyp:d.charge_calculation instanceof Array?d.charge_calculation[0]:d.charge_calculation,classAmt:d.charge_price,fractionFlg:d.charge_carry instanceof Array?d.charge_carry[0]:d.charge_carry,keepDigits:d.charge_figures,pcntAmt:d.charge_reward,perAmt:d.charge_every,id:Math.random()},u?"store"===l?(g=r[0].cpParamDtos.findIndex(function(t){return t.id==u}),f.id=u,r[0].cpParamDtos[g]=f):(y=c[0].cpParamDtos.findIndex(function(t){return t.id==u}),f.id=u,c[0].cpParamDtos[y]=f):"store"===l?(s.charge_mid_type.componentOptions.disabled=!0,s.charge_mid_code.componentOptions.disabled=!0,r.length?r[0].cpParamDtos.push(f):r.push({calcMode:m,calcTyp:null,cpParamDtos:[f],cpadditionId:null,cpadditionTyp:"R01",fractionFlg:null,keepDigits:null,pcntAmt:null,perAmt:null,trncdId:h})):(p.charge_bot_type.componentOptions.disabled=!0,c.length?c[0].cpParamDtos.push(f):c.push({calcMode:_,calcTyp:null,cpParamDtos:[f],cpadditionId:null,cpadditionTyp:"R02",fractionFlg:null,keepDigits:null,pcntAmt:null,perAmt:null,trncdId:null})),t.next=15,b({type:"updateTopForm",elements:n.elements,formdata:n.formdata,stored_value_data:r,awarding_data:c,elements_mid:s,elements_bot:p});case 15:case"end":return t.stop()}},t,this)}),updateTransactionCode:o.a.mark(function t(e,a){var n,r,c=e.code,s=a.select,p=a.put;a.call;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s(function(t){return t.M01378025A120LT00201});case 2:return n=t.sent,r=i()(n.element_top_type),r.charge_top_trncdId.componentOptions.options="502"===c||"501"===c?n.tradecodedata.filter(function(t){return"C"===t["data-datasource"].normal}):n.tradecodedata.filter(function(t){return"D"===t["data-datasource"].normal&&"280"===t["data-datasource"].trn_typ}),t.next=7,p({type:"updateTopForm",element_top_type:r});case 7:case"end":return t.stop()}},t,this)}),updateItem:o.a.mark(function t(e,a){var r,c,i=e.ifedit,s=(e.data,a.select),p=(a.put,a.call);return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s(function(t){return t.M01378025A120LT00201});case 2:if(r=t.sent,r.stored_value_data.length&&(r.stored_value_data[0].trncdId=r.formdata_mid.charge_mid_code),c={additionParamDtos:[].concat(n(r.stored_value_data),n(r.awarding_data))||[],chargepolicyCd:r.formdata.charge_top_code.toUpperCase(),chargepolicyNm:r.formdata.charge_top_name,chargepolicyTyp:r.formdata.charge_top_type instanceof Array?r.formdata.charge_top_type[0]:r.formdata.charge_top_type,note:r.formdata.charge_top_note,rankDtos:r.formdata.charge_top_lev.map(function(t){return{mcardrankId:null,memberrankId:t}}),seq:r.formdata.charge_top_seq,trnAmt:r.formdata.charge_top_trnAmt,trncdId:r.formdata.charge_top_trncdId instanceof Array?r.formdata.charge_top_trncdId[0]:r.formdata.charge_top_trncdId},!i){t.next=12;break}return c.chargepolicy_id=r.oldeditdata.chargepolicyId,c.version=r.oldeditdata.version,t.next=10,p(h.editFormItem,{submitData:c,originData:Object.assign({},null)});case 10:t.next=14;break;case 12:return t.next=14,p(h.addNewItem,{submitData:c,originData:Object.assign({},null)});case 14:case"end":return t.stop()}},t,this)}),transMoney:o.a.mark(function t(e,a){var n,r,c=e.state,s=a.select,p=a.put;a.call;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s(function(t){return t.M01378025A120LT00201});case 2:return n=t.sent,r=i()(n.elements),r.charge_top_trnAmt.componentOptions.text=c?m.a.amount_charge:m.a.money,t.next=7,p({type:"updateTopForm",elements:r});case 7:case"end":return t.stop()}},t,this)}),updateForm:o.a.mark(function t(e,a){var n=e.formdata,r=(a.select,a.put);a.call;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r({type:"updateTopForm",formdata:n});case 2:case"end":return t.stop()}},t,this)}),deleteLabel:o.a.mark(function t(e,a){var n,r,c,s,p,d,u,l,m,_,h,f,g=a.select,y=a.put;a.call;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.cbParams,r=n.data,c=n.type,t.next=3,g(function(t){return t.M01378025A120LT00201});case 3:return s=t.sent,p=i()(s.stored_value_data),d=i()(s.awarding_data),u=i()(s.elements_mid),l=i()(s.elements_bot),e.confirm&&("store"===c?(m=p.findIndex(function(t){return void 0!==t.cpParamDtos.find(function(t){return t.id==r.id})}),_=p[m].cpParamDtos.findIndex(function(t){return t.id==r.id}),p[m].cpParamDtos.splice(_,1),p[m].cpParamDtos.length||(u.charge_mid_type.componentOptions.disabled=!1,u.charge_mid_code.componentOptions.disabled=!1)):(h=d.findIndex(function(t){return void 0!==t.cpParamDtos.find(function(t){return t.id==r.id})}),f=d[h].cpParamDtos.findIndex(function(t){return t.id==r.id}),d[h].cpParamDtos.splice(f,1),d[h].cpParamDtos.length||(l.charge_bot_type.componentOptions.disabled=!1))),t.next=11,y({type:"updateTopForm",stored_value_data:p,awarding_data:d,elements_mid:u,elements_bot:l});case 11:case"end":return t.stop()}},t,this)})},reducers:{translateState:function(t,e){var a=e.newstate;return Object.assign({},t,{isnew:a})},updateTopForm:function(t,e){return Object.assign({},t,e)}}};e.default=g}.call(e,a(15))},3047:function(t,e,a){"use strict";var n=a(1),r=(a.n(n),a(60)),o=(a.n(r),a(555));e.a={routeParams:{},rightOperTop:{save:{text:"\u4fdd\u5b58",className:"icon32 img81",keyboard:"GF08"},back:{text:"\u53d6\u6d88",className:"icon32 img83",keyboard:"GF10"}},tradecodedata:[],oldeditdata:{},isnew:!1,stored_value_data:[],awarding_data:[],formdata:{charge_top_code:"",charge_top_name:"",charge_top_lev:[],charge_top_type:"",charge_top_trncdId:"",charge_top_trnAmt:"",charge_top_seq:"",charge_top_note:""},formdata_mid:{charge_mid_type:"C",charge_mid_code:""},formdata_bot:{charge_bot_type:"C"},elements_bot:{charge_bot_type:{type:"select",width:4,interactionOptions:{isMust:!0},componentOptions:{text:o.a.model,selection:!0,options:[{key:"0",value:"C",text:o.a.classification},{key:"1",value:"L",text:o.a.ladder}]}}},elements_mid:{charge_mid_type:{type:"select",width:4,interactionOptions:{isMust:!0},componentOptions:{text:o.a.model,selection:!0,options:[{key:"0",value:"C",text:o.a.classification},{key:"1",value:"L",text:o.a.ladder}]}},charge_mid_code:{type:"select",width:4,interactionOptions:{isMust:!0},componentOptions:{text:o.a.tradecode,selection:!0,options:[]}}},elements:{charge_top_code:{type:"input",width:4,interactionOptions:{isMust:!0},componentOptions:{text:o.a.code}},charge_top_name:{type:"input",width:4,interactionOptions:{isMust:!0},componentOptions:{text:o.a.name}},charge_top_lev:{type:"select",width:8,interactionOptions:{isMust:!0},componentOptions:{text:o.a.memberlev,selection:!0,multiple:!0,options:[]}},charge_top_type:{type:"select",width:4,interactionOptions:{isMust:!0},componentOptions:{text:o.a.type,selection:!0,options:[{key:"0",value:"101",text:o.a.registered},{key:"1",value:"201",text:o.a.open_card},{key:"2",value:"203",text:o.a.fill_card},{key:"3",value:"501",text:o.a.first_flush},{key:"4",value:"502",text:o.a.renewal}]}},charge_top_trnAmt:{type:"input",width:4,interactionOptions:{isMust:!0},componentOptions:{text:o.a.money}},charge_top_seq:{type:"input",width:4,componentOptions:{text:o.a.seq}}},element_top_note:{charge_top_note:{type:"textarea",width:16,componentOptions:{text:o.a.note}}},element_top_type:{charge_top_trncdId:{type:"select",width:4,interactionOptions:{isMust:!0},componentOptions:{text:o.a.net_code,selection:!0,options:[]}}}}},3048:function(t,e,a){"use strict";function n(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){function n(r,o){try{var c=e[r](o),i=c.value}catch(t){return void a(t)}if(!c.done)return Promise.resolve(i).then(function(t){n("next",t)},function(t){n("throw",t)});t(i)}return n("next")})}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}a.d(e,"a",function(){return s});var o=a(38),c=a.n(o),i=a(257),s=function t(){var e=this;r(this,t),this.getMenberList=n(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(i.a)("/bs/3540010/LpsCmmMemberrank/queryMemberrankList","get",{});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,e)})),this.getDetailData=function(){var t=n(c.a.mark(function t(a){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(i.a)("/bs/3540010/LpsSetChargepolicy/getLpsSetChargepolicy","get",a);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}(),this.addNewItem=function(){var t=n(c.a.mark(function t(a){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(i.a)("/bs/3540010/LpsSetChargepolicy/saveChargepolicy","post",a);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}(),this.editFormItem=function(){var t=n(c.a.mark(function t(a){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(i.a)("/bs/3540010/LpsSetChargepolicy/editChargepolicy","post",a);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}()}}});